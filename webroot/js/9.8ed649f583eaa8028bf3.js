(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{450:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(90);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}t.a=function(e){return function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),u(this,i(n).apply(this,arguments))}var r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),r=n,(s=[{key:"render",value:function(){return a.a.createElement("div",{className:"with-navbar"},a.a.createElement(o.a,null),a.a.createElement(e,this.props))}}])&&c(r.prototype,s),n}(a.a.Component)}},501:function(e,t,n){var r=n(502);"string"==typeof r&&(r=[[e.i,r,""]]);n(19)(r,{insert:"head",singleton:!1}),r.locals&&(e.exports=r.locals)},502:function(e,t,n){(t=e.exports=n(18)(!1)).push([e.i,"._3Ij4O5TFbxHZV2ncCoFYod {\n    position: fixed;\n    top: 0;\n    left: 0;\n    margin-top: 2.5rem;\n    height: calc(100% - 2.5rem);\n    width: 100%;\n    background-color: #ffffff;\n}\n\n._28turk4UKi2Ru5cIt6MbeI {\n    position: absolute;\n    left: -20rem;\n    height: 100%;\n    width: 20rem;\n    box-shadow: 1px 0 7px rgba(0, 0, 0, 0.50);\n}\n\n._2Ql5w6_ss10QAjJE2q8mnS {\n    padding: 0.5rem;\n}\n\n.uUfyF2j3ThoL3moqcm6v3 {\n    cursor: pointer;\n    padding: 0.5rem;\n    border-top: 1px solid rgba(0, 0, 0, 0.15);\n    transition: background-color 200ms ease-in-out;\n}\n\n.uUfyF2j3ThoL3moqcm6v3:last-child {\n    border-bottom: 1px solid rgba(0, 0, 0, 0.15);\n}\n\n.uUfyF2j3ThoL3moqcm6v3:hover {\n    background-color: #eaeaea;\n}\n\n.jjU0DSCaerLrEKuyUjm1f {\n    position: absolute;\n    left: 0;\n    height: 100%;\n    width: 100%;\n\n    display: flex;\n    flex-direction: column;\n}\n\n._3Luufb16zepWMVME_m5W0x {\n    flex: 1;\n    border-bottom: 1px solid black;\n    padding: 1rem;\n    display: flex;\n    flex-direction: column-reverse;\n    overflow-y: auto;\n}\n\n._31Fj3O7XXR7vcrV6oIC-WP {\n    padding: 1rem;\n    width: 100%;\n}\n\n._3a71DyW5I_uxBkkyfIm8J0 {\n    margin: .5rem 0;\n}\n\n._3a71DyW5I_uxBkkyfIm8J0 span {\n    padding: 0.375rem 1rem;\n    border-radius: 3px;\n    color: var(--grey-light);\n}\n\n._2RL0BaKsHJULgC7snPRj2k {\n    text-align: right;\n}\n\n._2RL0BaKsHJULgC7snPRj2k span {\n    background-color: var(--blue);\n}\n\n._2KoC120bishiR8tPGjdd5t {\n    text-align: left;\n}\n\n._2nxTHqdaneZ7eztGbxt1uF {\n    font-weight: 600;\n}\n\n.LqwRUstvz9UIKu6i5pkhP {\n    background-color: #eaeaea;\n}\n\n._2KoC120bishiR8tPGjdd5t span {\n    background-color: var(--secondary);\n}\n\n@media screen and (min-width: 600px) {\n    ._28turk4UKi2Ru5cIt6MbeI {\n        left: 0;\n    }\n\n    .jjU0DSCaerLrEKuyUjm1f {\n        left: 20rem;\n        width: calc(100% - 20rem);\n    }\n}\n",""]),t.locals={chat:"_3Ij4O5TFbxHZV2ncCoFYod",usersWrapper:"_28turk4UKi2Ru5cIt6MbeI",searchUser:"_2Ql5w6_ss10QAjJE2q8mnS",user:"uUfyF2j3ThoL3moqcm6v3",messagesWrapper:"jjU0DSCaerLrEKuyUjm1f",messages:"_3Luufb16zepWMVME_m5W0x",sendMessage:"_31Fj3O7XXR7vcrV6oIC-WP",message:"_3a71DyW5I_uxBkkyfIm8J0",mineMessage:"_2RL0BaKsHJULgC7snPRj2k",theirMessage:"_2KoC120bishiR8tPGjdd5t",new:"_2nxTHqdaneZ7eztGbxt1uF",active:"LqwRUstvz9UIKu6i5pkhP"}},510:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(501),s=n.n(o),c=n(64),u=n.n(c),i=n(147),l=n.n(i),f=n(32),p=n(10),d=n(2),m=n(4),b=n.n(m),v=function(e){return function(t){t({type:d.d.setUsers,payload:e})}},h=function(e){return function(t){t({type:d.d.setMessages,payload:e})}},y=function(e){return function(t){t({type:d.d.addMessageToFirst,payload:e})}},g=function(e){return function(t,n){var r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r="ws://127.0.0.1:4567/chat?id=".concat(e),t({type:d.d.subscribe,payload:r}),n.abrupt("return",Promise.resolve());case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",Promise.reject(n.t0));case 9:case"end":return n.stop()}}),null,null,[[0,6]])}},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(t){var n,r;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,n={page:e},a.next=4,regeneratorRuntime.awrap(b.a.get("/api/chats",{params:n}));case 4:if(200===(r=a.sent).data.status){a.next=7;break}throw new Error("Invalid Status");case 7:if(Array.isArray(r.data.data)){a.next=9;break}throw new Error("Invalid Data");case 9:return t(v(r.data.data)),a.abrupt("return",Promise.resolve(r.data.data));case 13:return a.prev=13,a.t0=a.catch(0),t({type:d.d.setError}),a.abrupt("return",Promise.reject(a.t0));case 17:case"end":return a.stop()}}),null,null,[[0,13]])}},w=function(e){return function(t){var n;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t(y(e)),r.next=4,regeneratorRuntime.awrap(b.a.post("/api/chats",e));case 4:if(200===(n=r.sent).data.status){r.next=7;break}throw new Error("Invalid Status");case 7:return r.abrupt("return",Promise.resolve(n.data.data));case 10:return r.prev=10,r.t0=r.catch(0),r.abrupt("return",Promise.reject(r.t0));case 13:case"end":return r.stop()}}),null,null,[[0,10]])}},O=n(450);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var P=function(e){var t=Object(p.c)(),n=Object(p.d)((function(e){return e.chat})),o=n.users,c=n.userInfo,i=k(Object(r.useState)(1),2),l=i[0],f=i[1],d=k(Object(r.useState)(!1),2),m=d[0],b=d[1],v=Object(r.useCallback)((function(t){return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:e.history.push("/chat"),e.history.push("/chat?id=".concat(t));case 2:case"end":return n.stop()}}))}),[]),h=Object(r.useCallback)((function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(t(j(l)));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),b(!0);case 8:case"end":return e.stop()}}),null,null,[[0,5]])}),[l]);return Object(r.useEffect)((function(){h(),f(1)}),[h]),m?"":a.a.createElement("div",{className:s.a.usersWrapper},a.a.createElement("div",{className:s.a.searchUser},"Search"),a.a.createElement("div",{className:s.a.users},o.map((function(e,t){var n;return a.a.createElement("div",{className:u()(s.a.user,(n={},_(n,s.a.new,!!e.new&&c.id!==e.id),_(n,s.a.active,!!c.id&&c.id==e.id),n)),key:t,onClick:function(){return v(e.id)}},e.username,a.a.createElement("div",{className:"disabled"},e.message))}))))},R=function(){var e=Object(p.c)(),t=Object(p.d)((function(e){return e.chat})),n=t.userInfo,o=t.messages,c=t.ws,i=Object(p.d)((function(e){return e.auth})).user,l=k(Object(r.useState)(""),2),f=l[0],m=l[1];Object(r.useEffect)((function(){null!==c&&(0===Object.entries(n).length&&n.constructor===Object||(c.onmessage=function(t){var r=JSON.parse(t.data);e(function(e){return function(t){t({type:d.d.setUserToFirst,payload:e})}}(r.user)),Number(r.user_id)===Number(n.id)&&e(y(r))},c.onclose=function(e){setTimeout((function(){g(i.id)}),1e3)},c.onerror=function(t){e({type:d.d.unsubscribe}),e({type:d.d.setError})}))}),[c,n]);var b=Object(r.useCallback)((function(t){var r,a;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t&&t.preventDefault(),r={message:f,user_id:i.id,receiver_id:n.id},m(""),o.prev=3,o.next=6,regeneratorRuntime.awrap(e(w(r)));case 6:null!==c&&(a=E({},r,{user:i}),c.send(JSON.stringify(a))),o.next=11;break;case 9:o.prev=9,o.t0=o.catch(3);case 11:case"end":return o.stop()}}),null,null,[[3,9]])}),[f,n]);return 0===Object.entries(n).length&&n.constructor===Object?a.a.createElement("div",{className:s.a.messagesWrapper}):a.a.createElement("div",{className:s.a.messagesWrapper},a.a.createElement("div",{className:s.a.userInfo}),a.a.createElement("div",{className:s.a.messages},o.map((function(e,t){var n;return a.a.createElement("div",{className:u()(s.a.message,(n={},_(n,s.a.mineMessage,i.id===e.user_id),_(n,s.a.theirMessage,i.id!==e.user_id),n)),key:t},a.a.createElement("span",null,e.message))}))),a.a.createElement("div",{className:s.a.sendMessage},a.a.createElement("form",{onSubmit:b},a.a.createElement("input",{type:"text",placeholder:"Enter your message",value:f,onChange:function(e){return m(e.target.value)}}))))},I=Object(f.g)(Object(O.a)((function(e){var t=Object(p.d)((function(e){return e.chat})),n=t.ws,o=t.error,c=Object(p.d)((function(e){return e.auth})).user,u=Object(p.c)();return Object(r.useEffect)((function(){return u(g(c.id)),function(){u((c.id,function(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e({type:d.d.unsubscribe}),t.abrupt("return",Promise.resolve());case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",Promise.reject(t.t0));case 8:case"end":return t.stop()}}),null,null,[[0,5]])}))}}),[]),Object(r.useEffect)((function(){var t=l.a.parse(e.location.search).id;t&&u(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){var r,a,o;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,r={page:t},s.next=4,regeneratorRuntime.awrap(b.a.get("/api/chats/".concat(e),{params:r}));case 4:if(a=s.sent,o=a.data.data,200===a.data.status){s.next=8;break}throw new Error("Invalid Status");case 8:if(Array.isArray(o.messages)){s.next=10;break}throw new Error("Invalid Data");case 10:return n(h(o.messages)),n({type:d.d.setUserInfo,payload:o.userInfo}),s.abrupt("return",Promise.resolve(o));case 15:return s.prev=15,s.t0=s.catch(0),n({type:d.d.setError}),s.abrupt("return",Promise.reject(s.t0));case 19:case"end":return s.stop()}}),null,null,[[0,15]])}}(t))}),[e.location.search]),o?a.a.createElement("div",{className:s.a.chat},a.a.createElement("div",{className:"disabled"},"Oops something went wrong")):null===n?a.a.createElement("div",{className:s.a.chat}):a.a.createElement("div",{className:s.a.chat},a.a.createElement(P,e),a.a.createElement(R,null))})));t.default=I}}]);