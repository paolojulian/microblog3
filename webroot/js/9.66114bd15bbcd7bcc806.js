(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{450:function(e,r,t){"use strict";var n=t(0),a=t.n(n),o=t(90);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,r){return!r||"object"!==s(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,r){return(l=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}r.a=function(e){return function(r){function t(){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,i(t).apply(this,arguments))}var n,s;return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&l(e,r)}(t,r),n=t,(s=[{key:"render",value:function(){return a.a.createElement("div",{className:"with-navbar"},a.a.createElement(o.a,null),a.a.createElement(e,this.props))}}])&&c(n.prototype,s),t}(a.a.Component)}},501:function(e,r,t){var n=t(502);"string"==typeof n&&(n=[[e.i,n,""]]);t(19)(n,{insert:"head",singleton:!1}),n.locals&&(e.exports=n.locals)},502:function(e,r,t){(r=e.exports=t(18)(!1)).push([e.i,"._3Ij4O5TFbxHZV2ncCoFYod {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    margin-top: 2.5rem;\r\n    height: calc(100% - 2.5rem);\r\n    width: 100%;\r\n    background-color: #ffffff;\r\n}\r\n\r\n._28turk4UKi2Ru5cIt6MbeI {\r\n    position: absolute;\r\n    left: -20rem;\r\n    height: 100%;\r\n    width: 20rem;\r\n    box-shadow: 1px 0 7px rgba(0, 0, 0, 0.50);\r\n}\r\n\r\n._2Ql5w6_ss10QAjJE2q8mnS {\r\n    padding: 0.5rem;\r\n}\r\n\r\n.uUfyF2j3ThoL3moqcm6v3 {\r\n    cursor: pointer;\r\n    padding: 0.5rem;\r\n    border-top: 1px solid rgba(0, 0, 0, 0.15);\r\n    transition: background-color 200ms ease-in-out;\r\n}\r\n\r\n.uUfyF2j3ThoL3moqcm6v3:last-child {\r\n    border-bottom: 1px solid rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.uUfyF2j3ThoL3moqcm6v3:hover {\r\n    background-color: #eaeaea;\r\n}\r\n\r\n.jjU0DSCaerLrEKuyUjm1f {\r\n    position: absolute;\r\n    left: 0;\r\n    height: 100%;\r\n    width: 100%;\r\n\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n._3Luufb16zepWMVME_m5W0x {\r\n    flex: 1;\r\n    border-bottom: 1px solid black;\r\n    padding: 1rem;\r\n    display: flex;\r\n    flex-direction: column-reverse;\r\n    overflow-y: auto;\r\n}\r\n\r\n._31Fj3O7XXR7vcrV6oIC-WP {\r\n    padding: 1rem;\r\n    width: 100%;\r\n}\r\n\r\n._3a71DyW5I_uxBkkyfIm8J0 {\r\n    margin: .5rem 0;\r\n}\r\n\r\n._3a71DyW5I_uxBkkyfIm8J0 span {\r\n    padding: 0.375rem 1rem;\r\n    border-radius: 3px;\r\n    color: var(--grey-light);\r\n}\r\n\r\n._2RL0BaKsHJULgC7snPRj2k {\r\n    text-align: right;\r\n}\r\n\r\n._2RL0BaKsHJULgC7snPRj2k span {\r\n    background-color: var(--blue);\r\n}\r\n\r\n._2KoC120bishiR8tPGjdd5t {\r\n    text-align: left;\r\n}\r\n\r\n._2nxTHqdaneZ7eztGbxt1uF {\r\n    font-weight: 600;\r\n}\r\n\r\n.LqwRUstvz9UIKu6i5pkhP {\r\n    background-color: #eaeaea;\r\n}\r\n\r\n._2KoC120bishiR8tPGjdd5t span {\r\n    background-color: var(--secondary);\r\n}\r\n\r\n@media screen and (min-width: 600px) {\r\n    ._28turk4UKi2Ru5cIt6MbeI {\r\n        left: 0;\r\n    }\r\n\r\n    .jjU0DSCaerLrEKuyUjm1f {\r\n        left: 20rem;\r\n        width: calc(100% - 20rem);\r\n    }\r\n}\r\n",""]),r.locals={chat:"_3Ij4O5TFbxHZV2ncCoFYod",usersWrapper:"_28turk4UKi2Ru5cIt6MbeI",searchUser:"_2Ql5w6_ss10QAjJE2q8mnS",user:"uUfyF2j3ThoL3moqcm6v3",messagesWrapper:"jjU0DSCaerLrEKuyUjm1f",messages:"_3Luufb16zepWMVME_m5W0x",sendMessage:"_31Fj3O7XXR7vcrV6oIC-WP",message:"_3a71DyW5I_uxBkkyfIm8J0",mineMessage:"_2RL0BaKsHJULgC7snPRj2k",theirMessage:"_2KoC120bishiR8tPGjdd5t",new:"_2nxTHqdaneZ7eztGbxt1uF",active:"LqwRUstvz9UIKu6i5pkhP"}},510:function(e,r,t){"use strict";t.r(r);var n=t(0),a=t.n(n),o=t(501),s=t.n(o),c=t(64),u=t.n(c),i=t(147),l=t.n(i),f=t(32),p=t(10),d=t(2),m=t(4),b=t.n(m),v=function(e){return function(r){r({type:d.d.setUsers,payload:e})}},h=function(e){return function(r){r({type:d.d.setMessages,payload:e})}},y=function(e){return function(r){r({type:d.d.addMessageToFirst,payload:e})}},g=function(e){return function(r,t){var n;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="ws://127.0.0.1:4567/chat?id=".concat(e),r({type:d.d.subscribe,payload:n}),t.abrupt("return",Promise.resolve());case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",Promise.reject(t.t0));case 9:case"end":return t.stop()}}),null,null,[[0,6]])}},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(r){var t,n;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t={page:e},a.next=4,regeneratorRuntime.awrap(b.a.get("/api/chats",{params:t}));case 4:if(200===(n=a.sent).data.status){a.next=7;break}throw new Error("Invalid Status");case 7:if(Array.isArray(n.data.data)){a.next=9;break}throw new Error("Invalid Data");case 9:return r(v(n.data.data)),a.abrupt("return",Promise.resolve(n.data.data));case 13:return a.prev=13,a.t0=a.catch(0),r({type:d.d.setError}),a.abrupt("return",Promise.reject(a.t0));case 17:case"end":return a.stop()}}),null,null,[[0,13]])}},w=function(e){return function(r){var t;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r(y(e)),n.next=4,regeneratorRuntime.awrap(b.a.post("/api/chats",e));case 4:if(200===(t=n.sent).data.status){n.next=7;break}throw new Error("Invalid Status");case 7:return n.abrupt("return",Promise.resolve(t.data.data));case 10:return n.prev=10,n.t0=n.catch(0),n.abrupt("return",Promise.reject(n.t0));case 13:case"end":return n.stop()}}),null,null,[[0,10]])}},O=t(450);function x(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function E(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?x(t,!0).forEach((function(r){_(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function k(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(t.push(s.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw o}}return t}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var P=function(e){var r=Object(p.c)(),t=Object(p.d)((function(e){return e.chat})),o=t.users,c=t.userInfo,i=k(Object(n.useState)(1),2),l=i[0],f=i[1],d=k(Object(n.useState)(!1),2),m=d[0],b=d[1],v=Object(n.useCallback)((function(r){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:e.history.push("/chat"),e.history.push("/chat?id=".concat(r));case 2:case"end":return t.stop()}}))}),[]),h=Object(n.useCallback)((function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(r(j(l)));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),b(!0);case 8:case"end":return e.stop()}}),null,null,[[0,5]])}),[l]);return Object(n.useEffect)((function(){h(),f(1)}),[h]),m?"":a.a.createElement("div",{className:s.a.usersWrapper},a.a.createElement("div",{className:s.a.searchUser},"Search"),a.a.createElement("div",{className:s.a.users},o.map((function(e,r){var t;return a.a.createElement("div",{className:u()(s.a.user,(t={},_(t,s.a.new,!!e.new&&c.id!==e.id),_(t,s.a.active,!!c.id&&c.id==e.id),t)),key:r,onClick:function(){return v(e.id)}},e.username,a.a.createElement("div",{className:"disabled"},e.message))}))))},R=function(){var e=Object(p.c)(),r=Object(p.d)((function(e){return e.chat})),t=r.userInfo,o=r.messages,c=r.ws,i=Object(p.d)((function(e){return e.auth})).user,l=k(Object(n.useState)(""),2),f=l[0],m=l[1];Object(n.useEffect)((function(){null!==c&&(0===Object.entries(t).length&&t.constructor===Object||(c.onmessage=function(r){var n=JSON.parse(r.data);e(function(e){return function(r){r({type:d.d.setUserToFirst,payload:e})}}(n.user)),Number(n.user_id)===Number(t.id)&&e(y(n))},c.onclose=function(e){setTimeout((function(){g(i.id)}),1e3)},c.onerror=function(r){e({type:d.d.unsubscribe}),e({type:d.d.setError})}))}),[c,t]);var b=Object(n.useCallback)((function(r){var n,a;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r&&r.preventDefault(),n={message:f,user_id:i.id,receiver_id:t.id},m(""),o.prev=3,o.next=6,regeneratorRuntime.awrap(e(w(n)));case 6:null!==c&&(a=E({},n,{user:i}),c.send(JSON.stringify(a))),o.next=11;break;case 9:o.prev=9,o.t0=o.catch(3);case 11:case"end":return o.stop()}}),null,null,[[3,9]])}),[f,t]);return 0===Object.entries(t).length&&t.constructor===Object?a.a.createElement("div",{className:s.a.messagesWrapper}):a.a.createElement("div",{className:s.a.messagesWrapper},a.a.createElement("div",{className:s.a.userInfo}),a.a.createElement("div",{className:s.a.messages},o.map((function(e,r){var t;return a.a.createElement("div",{className:u()(s.a.message,(t={},_(t,s.a.mineMessage,i.id===e.user_id),_(t,s.a.theirMessage,i.id!==e.user_id),t)),key:r},a.a.createElement("span",null,e.message))}))),a.a.createElement("div",{className:s.a.sendMessage},a.a.createElement("form",{onSubmit:b},a.a.createElement("input",{type:"text",placeholder:"Enter your message",value:f,onChange:function(e){return m(e.target.value)}}))))},I=Object(f.g)(Object(O.a)((function(e){var r=Object(p.d)((function(e){return e.chat})),t=r.ws,o=r.error,c=Object(p.d)((function(e){return e.auth})).user,u=Object(p.c)();return Object(n.useEffect)((function(){return u(g(c.id)),function(){u((c.id,function(e){return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e({type:d.d.unsubscribe}),r.abrupt("return",Promise.resolve());case 5:return r.prev=5,r.t0=r.catch(0),r.abrupt("return",Promise.reject(r.t0));case 8:case"end":return r.stop()}}),null,null,[[0,5]])}))}}),[]),Object(n.useEffect)((function(){var r=l.a.parse(e.location.search).id;r&&u(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(t){var n,a,o;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,n={page:r},s.next=4,regeneratorRuntime.awrap(b.a.get("/api/chats/".concat(e),{params:n}));case 4:if(a=s.sent,o=a.data.data,200===a.data.status){s.next=8;break}throw new Error("Invalid Status");case 8:if(Array.isArray(o.messages)){s.next=10;break}throw new Error("Invalid Data");case 10:return t(h(o.messages)),t({type:d.d.setUserInfo,payload:o.userInfo}),s.abrupt("return",Promise.resolve(o));case 15:return s.prev=15,s.t0=s.catch(0),t({type:d.d.setError}),s.abrupt("return",Promise.reject(s.t0));case 19:case"end":return s.stop()}}),null,null,[[0,15]])}}(r))}),[e.location.search]),o?a.a.createElement("div",{className:s.a.chat},a.a.createElement("div",{className:"disabled"},"Oops something went wrong")):null===t?a.a.createElement("div",{className:s.a.chat}):a.a.createElement("div",{className:s.a.chat},a.a.createElement(P,e),a.a.createElement(R,null))})));r.default=I}}]);